# 邮件服务设置指南

## 功能概述
- ✅ 注册自动发送验证邮件
- ✅ 邮箱验证成功后发送欢迎邮件
- ✅ 美观的邮件模板
- ✅ 使用 Resend 邮件服务

## 已配置功能

### 1. 邮件服务配置
- **服务提供商**: Resend
- **API Key**: 已配置在 `.env.local`
- **发件人**: `张江多功能墙 <onboarding@resend.dev>`
- **免费额度**: 3,000 封/月

### 2. 邮件类型

#### 注册验证邮件
- **触发时机**: 用户注册后自动发送
- **内容**: 验证链接、使用说明
- **模板**: 美观的 HTML 模板
- **有效期**: 24小时

#### 欢迎邮件
- **触发时机**: 邮箱验证成功后
- **内容**: 欢迎信息、功能介绍
- **模板**: 品牌化的欢迎页面

### 3. 验证流程
1. 用户注册账号
2. 系统自动发送验证邮件
3. 用户点击邮件中的验证链接
4. 系统验证邮箱并更新用户状态
5. 发送欢迎邮件
6. 用户可以使用所有功能

## 技术实现

### 邮件服务模块
- 文件: `src/lib/email.ts`
- 功能: 邮件发送、模板管理
- 错误处理: 完善的错误处理机制

### API 路由
- 文件: `src/app/api/auth/verify-email/route.ts`
- 功能: 处理邮箱验证请求
- 安全: 验证 token 有效性

### 页面组件
- 成功页面: `src/app/auth/success/page.tsx`
- 错误页面: `src/app/auth/error/page.tsx`
- 注册表单: `src/components/RegisterForm.tsx`

## 邮件模板特点

### 设计风格
- 现代化的渐变设计
- 响应式布局
- 品牌色彩搭配
- 清晰的信息层次

### 功能特性
- 一键验证按钮
- 备用验证链接
- 详细的使用说明
- 安全提示信息

## 测试结果
- ✅ 邮件发送测试通过
- ✅ 邮件ID: 117a08a4-c38f-4b69-b605-edbbb7ec68f5
- ✅ 收件人: zhongyi070622@163.com
- ✅ 主题: 张江多功能墙 - 邮件服务测试

## 使用说明

### 用户注册流程
1. 访问 http://localhost:3000
2. 点击"注册"按钮
3. 填写注册信息（邮箱必须是 hsefz.cn 域名）
4. 提交注册表单
5. 检查邮箱（包括垃圾邮件文件夹）
6. 点击验证链接
7. 验证成功后即可登录使用

### 管理员功能
- 管理员账号无需邮箱验证
- 可以直接登录使用
- 访问 http://localhost:3000/admin 管理验证请求

## 故障排除

### 如果邮件发送失败
1. 检查 Resend API Key 是否正确
2. 确认网络连接正常
3. 查看控制台错误信息
4. 检查 Resend 账户状态

### 如果验证链接无效
1. 确认链接未过期（24小时）
2. 检查链接是否被重复使用
3. 验证 Supabase 配置
4. 检查数据库连接

### 如果邮件未收到
1. 检查垃圾邮件文件夹
2. 确认邮箱地址正确
3. 等待几分钟（邮件可能有延迟）
4. 联系管理员重新发送

## 安全注意事项
- 验证链接有效期24小时
- 每个链接只能使用一次
- 邮件内容不包含敏感信息
- 使用 HTTPS 传输验证链接

## 生产环境配置
- 配置自定义域名（hsefz.cn）
- 设置 SPF/DKIM 记录
- 监控邮件发送状态
- 设置邮件发送限制

## 维护建议
- 定期检查邮件发送状态
- 监控 Resend 使用量
- 更新邮件模板内容
- 备份邮件配置信息 